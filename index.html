<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø¨Ù†Ù‰ Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: white;
      color: black;
      margin: 0;
      padding: 20px;
      font-weight: bold;
      overflow: auto;
    }

    /* Ø§Ù„Ø´Ø¹Ø§Ø± 1 ÙƒØ®Ù„ÙÙŠØ© */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://raw.githubusercontent.com/abdulkhaleq404/housing-system/refs/heads/main/logopng2.png');
      background-repeat: no-repeat;
      background-position: center center;
      background-size: 600px auto;
      opacity: 0.25;
      z-index: -2;
      pointer-events: none;
    }

    /* Ø§Ù„Ø´Ø¹Ø§Ø± 2 Ø®Ù„Ù Ø§Ù„ÙƒØ±ÙˆØª */
    #logo2 {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: -1;
      opacity: 1;
    }

    h2 {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: black;
      margin-bottom: 10px;
    }

    #main-btn {
      display: block;
      margin: 0 auto 10px auto;
      font-size: 19px;
      padding: 12px 20px;
      background-color: #0b2545;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
    }
    #main-btn:hover {
      background-color: #133b5c;
    }

    .floor-selection {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 10px 0;
      font-size: 18px;
    }

    .floor-btn {
      padding: 10px 18px;
      background-color: #2f2f2f;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
    }
    .floor-btn:hover {
      background-color: #3a3a3a;
    }

    .secondary-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    #all-btn, #duplicates-btn {
      padding: 10px 18px;
      background-color: #2f2f2f;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
    }
    #all-btn:hover, #duplicates-btn:hover {
      background-color: #3a3a3a;
    }

    #search {
      display: none; /* Ø¥Ø®ÙØ§Ø¤Ù‡ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
      margin: 10px auto;
      padding: 6px 10px;
      width: 200px;
      text-align: center;
      border-radius: 5px;
      border: 1px solid #444;
      background-color: #1e1e1e;
      color: white;
    }

    #export-btn, #report-link-btn {
      display: none;
      margin: 10px auto;
      padding: 6px 12px;
      font-size: 14px;
      background-color: #0b2545;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: center;
    }
    #export-btn:hover, #report-link-btn:hover {
      background-color: #133b5c;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      justify-items: center;
      margin-top: 20px;
    }

    .stat-box {
      background-color: #2c2c2c;
      border-radius: 8px;
      padding: 15px;
      width: 160px;
      text-align: center;
      font-size: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      color: white;
    }

    .stat-number {
      font-size: 28px;
      margin: 10px 0 0;
    }

    .cards-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    .room-card {
      background-color: #2c2c2c;
      border-radius: 8px;
      width: calc(25% - 10px);
      padding: 10px;
      box-sizing: border-box;
      transition: 0.3s ease;
      position: relative;
      color: white;
    }
    .room-card .room-title {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: center;
      color: white;
    }
    .room-card .toggle-btn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: none;
      color: white;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .room-card .occupants {
      display: none;
      margin-top: 10px;
    }
    .room-card .occupant {
      margin-bottom: 10px;
      background-color: #333;
      padding: 5px;
      border-radius: 4px;
      color: white;
    }
    .room-card .occupant input,
    .room-card .occupant select {
      width: 100%;
      padding: 5px;
      background-color: #2f2f2f;
      border: 1px solid #555;
      color: white;
      text-align: center;
      box-sizing: border-box;
      margin-bottom: 5px;
    }
    .room-card .status-dots {
      display: flex;
      gap: 4px;
      justify-content: center;
      margin-bottom: 5px;
    }
    .room-card .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: green;
    }
    .room-card .dot.filled {
      background-color: red;
    }
    .room-card .occupied-count {
      text-align: center;
      margin-bottom: 5px;
      color: white;
      font-size: 14px;
    }

    /* ØªÙ†Ø³ÙŠÙ‚ ØµÙ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø§Øª: 3 ÙƒØ±ÙˆØª ÙÙŠ Ø§Ù„ØµÙ */
    .duplicates-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .dup-card {
      background-color: #444;
      padding: 10px;
      border-radius: 8px;
      color: white;
      white-space: pre-wrap; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */
      text-align: right;
    }

    @media (max-width: 768px) {
      .room-card {
        width: 100%;
      }
      .stats-container {
        grid-template-columns: repeat(1, 1fr);
      }
      .duplicates-container {
        grid-template-columns: repeat(1, 1fr);
      }
    }
  
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .tasks-header {
      text-align: center;
      margin-bottom: 10px;
    }
    .tasks-header button {
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #0b2545;
      color: white;
      border: none;
      cursor: pointer;
    }
    .tasks-container {
      display: flex; flex-direction: row; flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .task-card {
      background-color: white; color: black; padding: 10px;
      border-radius: 8px;
      color: white;
    }
    .task-card input,
    .task-card textarea {
      width: 100%;
      margin-bottom: 5px;
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #555;
      background-color: #333;
      color: white;
      box-sizing: border-box;
    }
    .task-card textarea {
      height: 60px;
      resize: none;
    }
    .task-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }
    .task-actions button {
      flex: 1;
      margin: 0 5px;
      padding: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #444;
      color: white;
    }
    .task-actions .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 5px;
      background-color: #ccc;
      vertical-align: middle;
    }

  
    /* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ±Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙŠØ¨Ù‚Ù‰ */
    /* ØªÙ†Ø³ÙŠÙ‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .cards-container .tasks-header {
      grid-column: 1 / -1 !important;
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tasks-container {
      display: grid !important;
      grid-template-columns: repeat(3, minmax(200px, 1fr)) !important;
      gap: 15px !important;
      width: 100%;
      margin: 0 auto;
    }
    .task-card {
      background-color: #2c2c2c !important;
      color: white !important;
      padding: 15px !important;
      border-radius: 8px !important;
      text-align: center !important;
      box-sizing: border-box !important;
    }
    .task-buttons {
      text-align: center !important;
      margin-top: 10px !important;
    }
    /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªÙ…ÙˆØ¶Ø¹ Ø«Ø§Ø¨Øª Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø²Ø± */
    .tasks-header {
      position: static !important;
      top: auto !important;
      left: auto !important;
      transform: none !important;
    }


    /* Ø²Ø± Ø§Ù„Ø­Ø°Ù ØªØ­Øª Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
    .task-delete {
      text-align: center;
      margin: 10px 0;
    }

</style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-screen" style="display:flex; flex-direction:column; align-items:center; margin-top:50px;">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="login-username" type="text" placeholder="Username" style="padding:8px; margin:8px 0; width:250px;"/>
    <input id="login-password" type="password" placeholder="Password" style="padding:8px; margin:8px 0; width:250px;"/>
    <button id="login-button" style="padding:8px 16px; margin:8px 0;">Ø¯Ø®ÙˆÙ„</button>
  </div>
  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app" style="display:none;">

  <div id="logo2">
    <img src="https://raw.githubusercontent.com/abdulkhaleq404/housing-system/refs/heads/main/logopng3.png" alt="Ø´Ø¹Ø§Ø± Ø«Ø§Ù†ÙˆÙŠ" style="max-width: 250px; height: auto;">
  </div>

  <h2>Ù…Ø¨Ù†Ù‰ Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ</h2>
  <button id="main-btn" onclick="loadMain()">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

  <div class="floor-selection">
    <button class="floor-btn" onclick="loadFloor(1)">Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø£ÙˆÙ„</button>
    <button class="floor-btn" onclick="loadFloor(2)">Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
    <button class="floor-btn" onclick="loadFloor(3)">Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø«Ø§Ù„Ø«</button>
    <button class="floor-btn" onclick="loadFloor(4)">Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø±Ø§Ø¨Ø¹</button>
  </div>

  <div class="secondary-buttons">
    <button id="all-btn" onclick="loadFloor(0)">Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
    <button id="duplicates-btn" onclick="loadDuplicates()">Ø§Ù„Ù…ØªÙƒØ±Ø±Ø§Øª</button>
    <button id="tasks-btn" onclick="loadTasks()">Ø§Ù„Ù…Ù‡Ø§Ù…</button>
  </div>

  <input type="text" id="search" placeholder="Ø§Ù„Ø¨Ø­Ø«" oninput="searchRooms()">
  <button id="export-btn" onclick="exportData()">ØªÙ‚Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØºØ±Ù</button>
  <button id="report-link-btn" onclick="exportBuildingReport()">ØªÙ‚Ø±ÙŠØ± Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·Ø©</button>

  <div id="cards" class="cards-container"></div>

  
<script>
// Authentication
const ADMIN_USER = '3';
const ADMIN_PASS = '3';

document.addEventListener('DOMContentLoaded', async () => {
  document.getElementById('login-button').addEventListener('click', async () => {
    const user = document.getElementById('login-username').value;
    const pass = document.getElementById('login-password').value;
    if (user === ADMIN_USER && pass === ADMIN_PASS) {
      sessionStorage.setItem('loggedIn','true');
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      await loadData();
          await loadData();
    loadMain();
    } else {
      alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
    }
  });
  if (sessionStorage.getItem('loggedIn') === 'true') {
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    await loadData();
          await loadData();
    loadMain();
  }
});
</script>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¨Ø¯Ø¦ÙŠØ©
    let data = JSON.parse(localStorage.getItem('housingData') || `{
      "room-101": [
        {"name":"Ø³Ø¹ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø§Ù„ØªÙ…ÙŠÙ…ÙŠ","phone":"0539332262","rank":"Ø±Ø§Ø¦Ø¯","plate":"Ø¯ Ø¯ Ø§ - 4699","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""}
      ],
      "room-102": [
        {"name":"Ø¹Ø§Ù…Ø± ØµÙ‚Ø± Ø§Ù„Ø´Ù…Ø±ÙŠ","phone":"055146446","rank":"Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""}
      ],
      "room-103": [
        {"name":"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø­Ù…Ø¯ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ","phone":"0564082502","rank":"Ù…Ù‚Ø¯Ù…","plate":"Ø­ Ù† Ù† 8469","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""}
      ],
      "room-104": [
        {"name":"","phone":"","rank":"","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""},
        {"name":"","phone":"","rank":"","plate":"","grade":""}
      ]
      /* Ø£ÙƒÙ…Ù„ Ø¨Ù‚ÙŠØ© Ø§Ù„ØºØ±Ù Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© */
    }`);

    function saveToStorage() {
      localStorage.setItem('housingData', JSON.stringify(data));
    }

    function loadMain() {
      document.getElementById('search').style.display = 'none';
      document.getElementById('export-btn').style.display = 'none';
      document.getElementById('report-link-btn').style.display = 'none';

      let totalCapacity = 0;
      let filled = 0;
      let officerCount = 0;
      let enlistedCount = 0;
      let carCount = 0;
      const officerRanks = ['Ù…Ù„Ø§Ø²Ù…', 'Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„', 'Ù†Ù‚ÙŠØ¨', 'Ø±Ø§Ø¦Ø¯', 'Ù…Ù‚Ø¯Ù…', 'Ø¹Ù‚ÙŠØ¯', 'Ø¹Ù…ÙŠØ¯', 'Ù„ÙˆØ§Ø¡'];

      Object.keys(data).forEach(roomKey => {
        const room = data[roomKey];
        totalCapacity += room.length;
        room.forEach(person => {
          if (person.name) filled++;
          if (person.rank) {
            if (officerRanks.includes(person.rank)) officerCount++;
            else enlistedCount++;
          }
          if (person.plate && person.plate.trim() !== '') carCount++;
        });
      });

      document.getElementById('cards').innerHTML = `
        <div class="stats-container">
          <div class="stat-box"><div>Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div><div class="stat-number">${totalCapacity}</div></div>
          <div class="stat-box"><div>Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØªØ³ÙƒÙŠÙ†</div><div class="stat-number">${totalCapacity - filled}</div></div>
          <div class="stat-box"><div>Ø¹Ø¯Ø¯ Ø§Ù„Ø¶ÙŠÙˆÙ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†</div><div class="stat-number">${filled}</div></div>
          <div class="stat-box"><div>Ø§Ù„Ø¶Ø¨Ø§Ø·</div><div class="stat-number">${officerCount}</div></div>
          <div class="stat-box"><div>Ø§Ù„Ø£ÙØ±Ø§Ø¯</div><div class="stat-number">${enlistedCount}</div></div>
          <div class="stat-box"><div>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div><div class="stat-number">${carCount}</div></div>
        </div>
      `;
    }

    function loadFloor(floor) {
      const container = document.getElementById('cards');
      container.innerHTML = '';

      // Ø¥Ø¸Ù‡Ø§Ø± Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ù„Ø¬Ù…ÙŠØ¹"
      const searchInput = document.getElementById('search');
      searchInput.value = '';
      searchInput.style.display = (floor === 0 ? 'block' : 'none');

      // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ù„Ø¬Ù…ÙŠØ¹"
      document.getElementById('export-btn').style.display = (floor === 0 ? 'block' : 'none');
      document.getElementById('report-link-btn').style.display = (floor === 0 ? 'block' : 'none');

      // ØªØ±ØªÙŠØ¨ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØºØ±Ù ØªØµØ§Ø¹Ø¯ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…
      const keys = Object.keys(data).sort((a, b) => {
        const numA = parseInt(a.split('-')[1]);
        const numB = parseInt(b.split('-')[1]);
        return numA - numB;
      });

      // Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØºØ±Ù Ø¥Ø°Ø§ floor = 0ØŒ ÙˆØ¥Ù„Ø§ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø­Ø¯Ø¯
      keys.forEach(key => {
        const fl = parseInt(key.split('-')[1][0]);
        if (floor === 0 || fl === floor) {
          const card = createRoomCard(key, key.split('-')[1]);
          container.appendChild(card);
        }
      });
    }

    function createRoomCard(roomKey, roomNumber) {
      const card = document.createElement('div');
      card.className = 'room-card';

      const title = document.createElement('div');
      title.className = 'room-title';
      title.textContent = `ØºØ±ÙØ© | ${roomNumber}`;

      const toggle = document.createElement('button');
      toggle.className = 'toggle-btn';
      toggle.innerHTML = '+';
      toggle.onclick = () => {
        const occContainer = card.querySelector('.occupants');
        occContainer.style.display = occContainer.style.display === 'block' ? 'none' : 'block';
        toggle.innerHTML = occContainer.style.display === 'block' ? '-' : '+';
      };

      const filledCount = data[roomKey].filter(o => o.name).length;
      const capacity = data[roomKey].length;
      const occupiedDiv = document.createElement('div');
      occupiedDiv.className = 'occupied-count';
      occupiedDiv.textContent = `${filledCount} / ${capacity}`;

      const dots = document.createElement('div');
      dots.className = 'status-dots';
      data[roomKey].forEach(occ => {
        const dot = document.createElement('div');
        dot.className = 'dot' + (occ.name ? ' filled' : '');
        dots.appendChild(dot);
      });

      const occContainer = document.createElement('div');
      occContainer.className = 'occupants';
      occContainer.style.display = 'none';

      data[roomKey].forEach((occ, idx) => {
        const occDiv = document.createElement('div');
        occDiv.className = 'occupant';
        occDiv.innerHTML = `
          <input type="text" placeholder="Ø§Ù„Ø¥Ø³Ù…" value="${occ.name}" oninput="updateField('${roomKey}', ${idx}, 'name', this.value)">
          <input type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„" maxlength="10" value="${occ.phone}" oninput="updateField('${roomKey}', ${idx}, 'phone', this.value)">
          <select onchange="updateField('${roomKey}', ${idx}, 'rank', this.value)">
            <option value="">Ø§Ù„Ø±ØªØ¨Ø©</option>
            ${['Ø¬Ù†Ø¯ÙŠ','Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„','Ø¹Ø±ÙŠÙ','ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„','Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡','Ù…Ù„Ø§Ø²Ù…','Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„','Ù†Ù‚ÙŠØ¨','Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡']
              .map(rank => `<option value="${rank}" ${occ.rank === rank ? 'selected' : ''}>${rank}</option>`)
              .join('')}
          </select>
          <select onchange="updateField('${roomKey}', ${idx}, 'grade', this.value)">
            <option value="">Ø§Ù„Ù…Ø±ØªØ¨Ø©</option>
            ${Array.from({length:14}, (_,i)=>i+1).map(n=>`<option value="${n}" ${occ.grade==n? 'selected':''}>${n}</option>`).join('')}
          </select>
          <input type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©" value="${occ.plate}" oninput="updateField('${roomKey}', ${idx}, 'plate', this.value)">
        `;
        occContainer.appendChild(occDiv);
      });

      card.appendChild(title);
      card.appendChild(toggle);
      card.appendChild(occupiedDiv);
      card.appendChild(dots);
      card.appendChild(occContainer);

      return card;
    }

    function updateField(room, index, field, value) {
      data[room][index][field] = value;
      saveToStorage();
      document.querySelectorAll('.room-card').forEach(card => {
        const rNum = card.querySelector('.room-title').textContent.split('|')[1].trim();
        const key = 'room-' + rNum;
        if (key === room) {
          const occArr = data[room];
          const filledCount = occArr.filter(o => o.name).length;
          const capacity = occArr.length;
          card.querySelector('.occupied-count').textContent = `${filledCount} / ${capacity}`;
          card.querySelectorAll('.dot').forEach((dot, idx) => {
            dot.className = occArr[idx].name ? 'dot filled' : 'dot';
          });
        }
      });
    }

    function searchRooms() {
      const val = document.getElementById('search').value.trim().toLowerCase();
      document.querySelectorAll('.room-card').forEach(card => {
        const rNum = card.querySelector('.room-title').textContent.split('|')[1].trim();
        const key = 'room-' + rNum;
        const roomData = data[key];
        // Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©
        const match = roomData.some(occ => {
          return (occ.name.toLowerCase().includes(val) ||
                  occ.phone.toLowerCase().includes(val) ||
                  occ.rank.toLowerCase().includes(val) ||
                  occ.grade.toLowerCase().includes(val) ||
                  occ.plate.toLowerCase().includes(val));
        }) || rNum.includes(val);
        card.style.display = match ? 'block' : 'none';
      });
    }

    function loadDuplicates() {
      document.getElementById('search').style.display = 'none';
      document.getElementById('export-btn').style.display = 'none';
      document.getElementById('report-link-btn').style.display = 'none';
      const container = document.getElementById('cards');
      container.innerHTML = '<div class="duplicates-container" id="dup-container"></div>';
      const dupContainer = document.getElementById('dup-container');

      // ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙ‚Ø·
      const nameCount = {};
      Object.keys(data).forEach(room => {
        data[room].forEach(occ => {
          if (occ.name) nameCount[occ.name] = (nameCount[occ.name] || []).concat(room);
        });
      });

      Object.keys(nameCount).forEach(value => {
        const rooms = Array.from(new Set(nameCount[value]));
        if (value && rooms.length > 1) {
          const dupCard = document.createElement('div');
          dupCard.className = 'dup-card';
          const roomsList = rooms.map(r => r.replace('room-', '')).join(' - ');
          dupCard.textContent = `â€¢ ØªØ´Ø§Ø¨Ù‡ ÙÙŠ Ø§Ù„Ø§Ø³Ù…
( ${value} )
Ø§Ù„ØºØ±Ù ( ${roomsList} )`;
          dupContainer.appendChild(dupCard);
        }
      });
    }

    function exportData() {
      const now = new Date();
      const year = now.getFullYear();
      const month = (now.getMonth() + 1).toString().padStart(2, '0');
      const day = now.getDate().toString().padStart(2, '0');
      const gregorianDate = `${year}/${month}/${day}`;
      const dayName = now.toLocaleDateString('ar-SA', { weekday: 'long' });
      const hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const period = hours >= 12 ? 'Ù…' : 'Øµ';
      const formattedHour = hours % 12 || 12;
      const formattedTime = `Ø§Ù„Ø³Ø§Ø¹Ø© | ${formattedHour}:${minutes} ${period}`;

      let html = `<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <style> body { font-family: 'Arial'; padding: 20px; direction: rtl; text-align: right; } 
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .tasks-header {
      text-align: center;
      margin-bottom: 10px;
    }
    .tasks-header button {
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #0b2545;
      color: white;
      border: none;
      cursor: pointer;
    }
    .tasks-container {
      display: flex; flex-direction: row; flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .task-card {
      background-color: white; color: black; padding: 10px;
      border-radius: 8px;
      color: white;
    }
    .task-card input,
    .task-card textarea {
      width: 100%;
      margin-bottom: 5px;
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #555;
      background-color: #333;
      color: white;
      box-sizing: border-box;
    }
    .task-card textarea {
      height: 60px;
      resize: none;
    }
    .task-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }
    .task-actions button {
      flex: 1;
      margin: 0 5px;
      padding: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #444;
      color: white;
    }
    .task-actions .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 5px;
      background-color: #ccc;
      vertical-align: middle;
    }

  
    /* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ±Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙŠØ¨Ù‚Ù‰ */
    /* ØªÙ†Ø³ÙŠÙ‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .cards-container .tasks-header {
      grid-column: 1 / -1 !important;
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tasks-container {
      display: grid !important;
      grid-template-columns: repeat(3, minmax(200px, 1fr)) !important;
      gap: 15px !important;
      width: 100%;
      margin: 0 auto;
    }
    .task-card {
      background-color: #2c2c2c !important;
      color: white !important;
      padding: 15px !important;
      border-radius: 8px !important;
      text-align: center !important;
      box-sizing: border-box !important;
    }
    .task-buttons {
      text-align: center !important;
      margin-top: 10px !important;
    }
    /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªÙ…ÙˆØ¶Ø¹ Ø«Ø§Ø¨Øª Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø²Ø± */
    .tasks-header {
      position: static !important;
      top: auto !important;
      left: auto !important;
      transform: none !important;
    }


    /* Ø²Ø± Ø§Ù„Ø­Ø°Ù ØªØ­Øª Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
    .task-delete {
      text-align: center;
      margin: 10px 0;
    }

</style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-screen" style="display:flex; flex-direction:column; align-items:center; margin-top:50px;">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="login-username" type="text" placeholder="Username" style="padding:8px; margin:8px 0; width:250px;"/>
    <input id="login-password" type="password" placeholder="Password" style="padding:8px; margin:8px 0; width:250px;"/>
    <button id="login-button" style="padding:8px 16px; margin:8px 0;">Ø¯Ø®ÙˆÙ„</button>
  </div>
  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app" style="display:none;">

  <div>ØªÙ‚Ø±ÙŠØ± Ù…Ø¨Ù†Ù‰ Ø±Ø§Ø¨Ø·Ø© Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ</div>
  <div>Ø§Ù„ØªØ§Ø±ÙŠØ® | ${gregorianDate}</div>
  <div>Ø§Ù„ÙŠÙˆÙ… | ${dayName}</div>
  <div>${formattedTime}</div><br/>`;

      Object.keys(data).sort((a, b) => {
        const numA = parseInt(a.split('-')[1]);
        const numB = parseInt(b.split('-')[1]);
        return numA - numB;
      }).forEach(room => {
        if (data[room].some(occ => occ.name)) {
          const roomNum = room.replace('room-', '');
          html += `<div>â€¢ ØºØ±ÙØ© | ${roomNum}</div>`;
          data[room].forEach(occ => {
            if (occ.name) {
              html += `<div>Ø§Ù„Ø§Ø³Ù…: ${occ.name}</div>`;
              html += `<div>Ø§Ù„Ø±Ù‚Ù…: ${occ.phone}</div>`;
              if (occ.rank) html += `<div>Ø§Ù„Ø±ØªØ¨Ø©: ${occ.rank}</div>`;
              if (occ.grade) html += `<div>Ø§Ù„Ù…Ø±ØªØ¨Ø©: ${occ.grade}</div>`;
              html += `<div>Ø§Ù„Ù„ÙˆØ­Ø©: ${occ.plate}</div><br/>`;
            }
          });
        }
      });

      html += `  </div>
</body></html>`;
      const reportWindow = window.open("", "_blank");
      reportWindow.document.write(html);
    }

    function exportBuildingReport() {
      const now = new Date();
      const dayName = now.toLocaleDateString('ar-SA', { weekday: 'long' });
      const hijriDate = '1446/11/21Ù‡Ù€';

      let html = `<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <style> body { font-family: 'Arial'; padding: 20px; direction: rtl; text-align: right; } 
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .tasks-header {
      text-align: center;
      margin-bottom: 10px;
    }
    .tasks-header button {
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #0b2545;
      color: white;
      border: none;
      cursor: pointer;
    }
    .tasks-container {
      display: flex; flex-direction: row; flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .task-card {
      background-color: white; color: black; padding: 10px;
      border-radius: 8px;
      color: white;
    }
    .task-card input,
    .task-card textarea {
      width: 100%;
      margin-bottom: 5px;
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #555;
      background-color: #333;
      color: white;
      box-sizing: border-box;
    }
    .task-card textarea {
      height: 60px;
      resize: none;
    }
    .task-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
    }
    .task-actions button {
      flex: 1;
      margin: 0 5px;
      padding: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #444;
      color: white;
    }
    .task-actions .dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-left: 5px;
      background-color: #ccc;
      vertical-align: middle;
    }

  
    /* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ±Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙŠØ¨Ù‚Ù‰ */
    /* ØªÙ†Ø³ÙŠÙ‚ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… */
    .cards-container .tasks-header {
      grid-column: 1 / -1 !important;
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tasks-container {
      display: grid !important;
      grid-template-columns: repeat(3, minmax(200px, 1fr)) !important;
      gap: 15px !important;
      width: 100%;
      margin: 0 auto;
    }
    .task-card {
      background-color: #2c2c2c !important;
      color: white !important;
      padding: 15px !important;
      border-radius: 8px !important;
      text-align: center !important;
      box-sizing: border-box !important;
    }
    .task-buttons {
      text-align: center !important;
      margin-top: 10px !important;
    }
    /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ØªÙ…ÙˆØ¶Ø¹ Ø«Ø§Ø¨Øª Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø²Ø± */
    .tasks-header {
      position: static !important;
      top: auto !important;
      left: auto !important;
      transform: none !important;
    }


    /* Ø²Ø± Ø§Ù„Ø­Ø°Ù ØªØ­Øª Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
    .task-delete {
      text-align: center;
      margin: 10px 0;
    }

</style>
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-screen" style="display:flex; flex-direction:column; align-items:center; margin-top:50px;">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="login-username" type="text" placeholder="Username" style="padding:8px; margin:8px 0; width:250px;"/>
    <input id="login-password" type="password" placeholder="Password" style="padding:8px; margin:8px 0; width:250px;"/>
    <button id="login-button" style="padding:8px 16px; margin:8px 0;">Ø¯Ø®ÙˆÙ„</button>
  </div>
  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app" style="display:none;">

  <div>ğŸ›‘ ØªÙ‚Ø±ÙŠØ± Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø·Ø© ğŸ›‘</div>
  <div>Ø§Ù„ÙŠÙˆÙ… / ${dayName}</div>
  <div>Ø§Ù„Ù…ÙˆØ§ÙÙ‚ : ${hijriDate}</div><br/>`;

      const totalOccupied = Object.values(data).flat().filter(o => o.name).length;
      html += `<div>ğŸ”º Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§ÙƒÙ†ÙŠÙ† : (${totalOccupied})</div><hr/>`;

      const officerRanks = ['Ù…Ù„Ø§Ø²Ù…','Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„','Ù†Ù‚ÙŠØ¨','Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡'];
      let officerCount = 0, enlistedCount = 0;
      Object.values(data).flat().forEach(o => {
        if (o.rank) {
          if (officerRanks.includes(o.rank)) officerCount++;
          else enlistedCount++;
        }
      });
      html += `<div>- Ø§Ù„Ø¶Ø¨Ø§Ø·   Ø¹Ø¯Ø¯ (${officerCount})</div>`;
      html += `<div>- Ø§Ù„Ø£ÙØ±Ø§Ø¯   Ø¹Ø¯Ø¯ (${enlistedCount})</div><br/>`;

      html += `<div>Ø§Ù„Ø´Ø±Ø·Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© ( 5 )</div>`;
      html += `<div>Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø£Ù…Ù†ÙŠ ( 4 )</div>`;
      html += `<div>Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„ØºØ°Ø§Ø¦ÙŠ ( 4 )</div>`;
      html += `<div>Ø§Ù„Ù…ØµÙˆØ±ÙŠÙ† ( 12 )</div>`;
      html += `<div>Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø¨Ø§Øµ ( 9 )</div>`;
      html += `<hr/>`;

      html += `<div>ğŸ”º Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ğŸ”º</div>`;
      html += `<div>* ØªÙˆØ§Ø¬Ø¯ Ù…Ù†Ø³ÙˆØ¨ÙŠ Ø§Ù„Ø´Ø±Ø·Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©</div>`;
      html += `<div>* ØªÙˆØ§Ø¬Ø¯ Ø¹Ø¯Ø¯ (    ) Ø¹Ø§Ù…Ù„ÙŠÙ† Ù…ØªÙˆØ§Ø¬Ø¯ÙŠÙ† Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„ÙŠÙˆÙ… ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¨Ù†Ù‰ ÙƒØ§Ù…Ù„</div>`;
      html += `<div>* ØªÙˆØ§Ø¬Ø¯ Ø¹Ø¯Ø¯ (    ) Ø¹Ø§Ù…Ù„ Ù…Ù† Ø´Ø±ÙƒØ© Ø§Ù„Ù‚Ù†Ø§Øµ</div>`;
      html += `  </div>
</body></html>`;

      const reportWindow = window.open("", "_blank");
      reportWindow.document.write(html);
    }

    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…
    let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function loadTasks() {
      document.getElementById('search').style.display = 'none';
      document.getElementById('export-btn').style.display = 'none';
      document.getElementById('report-link-btn').style.display = 'none';
      document.getElementById('cards').innerHTML = '';
      const cards = document.getElementById('cards');
      // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©
      const header = document.createElement('div');
      header.className = 'tasks-header';
      const addBtn = document.createElement('button');
      addBtn.textContent = '+';
      addBtn.onclick = addTask;
      header.appendChild(addBtn);
      cards.appendChild(header);
      // Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ù…
      const container = document.createElement('div');
      container.className = 'tasks-container';
      container.id = 'tasks-container';
      cards.appendChild(container);
      tasks.forEach((task, index) => renderTask(task, index));
    }

    
    function addTask() {
      const task = { type: '', details: '', status: 'pending' };
      tasks.unshift(task);
      saveTasks();
      const container = document.getElementById('tasks-container');
      container.innerHTML = '';
      tasks.forEach((task, index) => renderTask(task, index));
    }
    

    function renderTask(task, index) {
      const container = document.getElementById('tasks-container');
      const card = document.createElement('div');
      card.className = 'task-card';
      card.setAttribute('data-index', index);
      card.innerHTML = `
        <input type="text" class="task-type" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©" value="${task.type}" oninput="updateTaskField(${index}, 'type', this.value)">
        <textarea class="task-details" placeholder="Ø§Ù„ØªÙØ§ØµÙŠÙ„" oninput="updateTaskField(${index}, 'details', this.value)">${task.details}</textarea>
        <div class="task-actions">
          <button onclick="setTaskStatus(${index}, 'pending')">ØªØ­Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© <span class="dot pending"></span></button>
          <button onclick="setTaskStatus(${index}, 'done')">ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© <span class="dot done"></span></button>
        </div>
        <div class="task-delete">
          <button class="delete-btn" onclick="deleteTask(${index})">Ø­Ø°Ù</button>
        </div>
      `;
      container.appendChild(card);
      updateTaskStatusDisplay(card, task.status);
    }

    function updateTaskField(index, field, value) {
      tasks[index][field] = value;
      saveTasks();
    }

    function setTaskStatus(index, status) {
      tasks[index].status = status;
      saveTasks();
      const card = document.querySelector(`.task-card[data-index="${index}"]`);
      updateTaskStatusDisplay(card, status);
    }

    function updateTaskStatusDisplay(card, status) {
      const pendingDot = card.querySelector('.dot.pending');
      const doneDot = card.querySelector('.dot.done');
      pendingDot.style.backgroundColor = status === 'pending' ? 'orange' : '#ccc';
      doneDot.style.backgroundColor = status === 'done' ? 'green' : '#ccc';
    }


    
    // Ø­Ø°Ù Ù…Ù‡Ù…Ø©
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…
    function renderAllTasks() {
      const container = document.getElementById('tasks-container');
      container.innerHTML = '';
      tasks.forEach((t, idx) => renderTask(t, idx));
    }

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveTasks();
      renderAllTasks();
    }
    
    
  </script>
  </div>
</body>
</html>
